# Codex 规则

## 相关技术栈
- 采用 Next.js + React 技术栈
- Next.js 使用 14 版本，目前不要使用 15 版本的新特性
- 使用 App Router
- UI 采用 `@mui/material`
- 状态管理使用 `@reduxjs/toolkit`
- 单元测试使用 Jest
- 数据请求使用 GraphQL

## 组件开发原则
- 未特殊说明时，在 `src/modules` 下为新组件建立同名目录，目录内包含：
  - `index.tsx`：主组件
  - `components/`：主组件调用的子组件
  - `hooks/`：组件相关的全部 hook
  - `constant.ts`：组件相关的常量
  - 视情况添加 `context.ts`、`utils/` 等文件
- 主组件需保持高内聚，尽量减少 props，允许接受布局相关的参数
- 主组件应自行获取并渲染数据，例如支付按钮包含弹窗与逻辑
- 主组件尽量只使用一个主 hook（UI 相关 hook 除外），主 hook 负责汇总逻辑与数据
- 主 hook 可以拆分为多个子 hook，均放在 `hooks/` 目录内
- 主组件文件不宜过大，超过 100 行需拆出子组件至 `components/` 下
- 子组件应尽量自包含，仅显示简单内容时可直接使用 props 渲染
- 避免内联样式，优先使用 MUI 的 `sx`/`style` 属性，并在组件下方集中定义样式
- 小型静态展示组件无需拆分成独立子组件
- 优先使用箭头函数定义组件
- 组件是否使用 `memo` 需结合渲染代价与频次评估
- 通过用户触发或条件显示的组件应考虑懒加载
- 优先复用 `src/components` 下已有组件，如需新增尽量不修改原实现
- 所有固定中文文案需通过 I18n 包裹
- 逻辑实现前优先检查 `src/utils` 是否已有可复用代码

## 数据传递与渲染
- 主组件应支持接收服务端初始化数据以用于 SSG，并在客户端完成数据刷新
- 若主组件具备初始数据且包含客户端请求，则在新数据返回前使用初始数据
- 显示 loading 或骨架图需同时满足：组件包含数据请求 hook 且无初始化数据
- 子组件若完全依赖 props 渲染则无需 loading/骨架图

## 命名与错误处理
- 采用驼峰命名法，组件名首字母大写
- 访问 JSON 数据前需做空值校验，防止渲染错误
- 在访问 `document`、`window`、`localStorage` 前使用 `utils/hooks/useIsClient` 判断客户端环境
- 对关键逻辑或易抛错的函数使用 `try/catch`

## 渲染规范
- 严格按照设计稿渲染，不增加额外元素
- 注意元素的布局关系（左右、上下、组合等）
- 若提供 Figma 链接且组件包含图片，应下载并放置于 `public/images/`，优先使用 SVG
- 默认仅考虑 PC 端渲染，除非同时提供移动端稿

## PC 与移动端适配
- 布局基本一致时，可使用 `theme.breakpoints.down('md')` 调整字号/间距
- PC 与移动端差异较大时，拆分为两个组件并通过 `components/WrapperPCAndMobile` 提供的 `WrapperPC`、`WrapperMobile` 控制显示